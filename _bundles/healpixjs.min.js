!function(t,s){"object"==typeof exports&&"object"==typeof module?module.exports=s():"function"==typeof define&&define.amd?define("healpixjs",[],s):"object"==typeof exports?exports.healpixjs=s():t.healpixjs=s()}(self,(()=>(()=>{"use strict";var t={d:(s,e)=>{for(var i in e)t.o(e,i)&&!t.o(s,i)&&Object.defineProperty(s,i,{enumerable:!0,get:e[i]})},o:(t,s)=>Object.prototype.hasOwnProperty.call(t,s),r:t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}},s={};t.r(s),t.d(s,{CircleFinder:()=>o,Constants:()=>e,Fxyf:()=>l,Healpix:()=>f,Hploc:()=>n,Pointing:()=>h,RangeSet:()=>c,Vec3:()=>a,Xyf:()=>p,Zphi:()=>r,pstack:()=>i});class e{}e.halfpi=1.5707963267948966,e.inv_halfpi=2/Math.PI,e.twopi=2*Math.PI,e.inv_twopi=1/(2*Math.PI);class i{constructor(t){this.p=new Array(t),this.o=new Int32Array(t),this.s=0,this.m=0}push(t,s){this.p[this.s]=t,this.o[this.s]=s,++this.s}pop(){--this.s}popToMark(){this.s=this.m}size(){return this.s}mark(){this.m=this.s}otop(){return this.o[this.s-1]}ptop(){return this.p[this.s-1]}}class h{constructor(t,s,e,i){null!=t?(this.theta=n.atan2(Math.sqrt(t.x*t.x+t.y*t.y),t.z),this.phi=s?-n.atan2(t.y,t.x):n.atan2(t.y,t.x),this.phi<0&&(this.phi=this.phi+2*Math.PI),this.phi>=2*Math.PI&&(this.phi=this.phi-2*Math.PI)):(this.theta=e,this.phi=i)}}class r{constructor(t,s){this.z=t,this.phi=s}}class n{constructor(t){n.PI4_A=.7853981554508209,n.PI4_B=7.946627356147928e-9,n.PI4_C=3061616997868383e-32,n.M_1_PI=.3183098861837907,t&&(this.sth=0,this.have_sth=!1,this.z=n.cos(t.theta),this._phi=t.phi,Math.abs(this.z)>.99&&(this.sth=n.sin(t.theta),this.have_sth=!0))}setZ(t){this.z=t}get phi(){return this._phi}set phi(t){this._phi=t}setSth(t){this.sth=t}toPointing(t){const s=this.have_sth?this.sth:Math.sqrt((1-this.z)*(1+this.z));return new h(null,!1,n.atan2(s,this.z),this._phi)}toVec3(){var t=this.have_sth?this.sth:Math.sqrt((1-this.z)*(1+this.z));return new a(t*n.cos(this.phi),t*n.sin(this.phi),this.z)}toZphi(){return new r(this.z,this.phi)}static sin(t){let s=t*n.M_1_PI,e=Math.floor(s<0?s-.5:s+.5),i=4*e;return t-=i*n.PI4_A,t-=i*n.PI4_B,t-=i*n.PI4_C,0!=(1&e)&&(t=-t),this.sincoshelper(t)}static cos(t){let s=t*n.M_1_PI-.5,e=1+2*Math.floor(s<0?s-.5:s+.5),i=2*e;return t-=i*n.PI4_A,t-=i*n.PI4_B,t-=i*n.PI4_C,0==(2&e)&&(t=-t),n.sincoshelper(t)}static sincoshelper(t){let s=t*t,e=-7972559550090379e-33;return e=e*s+2810099727108632e-30,e=e*s-7647122191181588e-28,e=e*s+1.605904306056645e-10,e=e*s-2.5052108376350205e-8,e=e*s+27557319223919875e-22,e=e*s-.00019841269841269616,e=e*s+.00833333333333333,e=e*s-.16666666666666666,s*e*t+t}static asin(t){return n.mulsign(n.atan2k(Math.abs(t),Math.sqrt((1+t)*(1-t))),t)}static acos(t){return n.mulsign(n.atan2k(Math.sqrt((1+t)*(1-t)),Math.abs(t)),t)+(t<0?Math.PI:0)}static mulsign(t,s){return n.copySign(1,s)*t}static copySign(t,s){return s<0?-Math.abs(t):Math.abs(t)}static atanhelper(t){let s=t*t,e=-1887960084630735e-20;return e=e*s+.00020985007664581698,e=e*s-.0011061183148667248,e=e*s+.003700267441887131,e=e*s-.008898961958876555,e=e*s+.016599329773529202,e=e*s-.025451762493231264,e=e*s+.03378525800013531,e=e*s-.04076291912768365,e=e*s+.04666671500778406,e=e*s-.052367485230348246,e=e*s+.05876663929266736,e=e*s-.06665735793610805,e=e*s+.07692195383117696,e=e*s-.09090899500824501,e=e*s+.11111110564826142,e=e*s-.1428571426677133,e=e*s+.19999999999659127,e=e*s-.3333333333333111,e*s*t+t}static atan2k(t,s){let e=0;if(s<0&&(s=-s,e=-2),t>s){let i=s;s=t,t=-i,e+=1}return n.atanhelper(t/s)+e*(Math.PI/2)}static atan2(t,s){let e=n.atan2k(Math.abs(t),s);return e=n.mulsign(e,s),(n.isinf(s)||0==s)&&(e=Math.PI/2-(n.isinf(s)?n.copySign(1,s)*(Math.PI/2):0)),n.isinf(t)&&(e=Math.PI/2-(n.isinf(s)?n.copySign(1,s)*(1*Math.PI/4):0)),0==t&&(e=-1==n.copySign(1,s)?Math.PI:0),n.isnan(s)||n.isnan(t)?NaN:n.mulsign(e,t)}static isnan(t){return t!=t}static isinf(t){return Math.abs(t)===1/0}}n.PI4_A=.7853981554508209,n.PI4_B=7.946627356147928e-9,n.PI4_C=3061616997868383e-32,n.M_1_PI=.3183098861837907;class a{constructor(t,s,e){if(t instanceof h){let s=t,e=n.sin(s.theta);this.x=e*n.cos(s.phi),this.y=e*n.sin(s.phi),this.z=n.cos(s.theta)}else this.x=t,this.y=s,this.z=e}getX(){return this.x}getY(){return this.y}getZ(){return this.z}scale(t){this.x*=t,this.y*=t,this.z*=t}cross(t){return new a(this.y*t.z-t.y*this.z,this.z*t.x-t.z*this.x,this.x*t.y-t.x*this.y)}add(t){return new a(this.x+t.x,this.y+t.y,this.z+t.z)}normalize(){let t=1/this.length();this.x*=t,this.y*=t,this.z*=t}norm(){let t=1/this.length();return new a(this.x*t,this.y*t,this.z*t)}length(){return Math.sqrt(this.lengthSquared())}lengthSquared(){return this.x*this.x+this.y*this.y+this.z*this.z}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z}sub(t){return new a(this.x-t.x,this.y-t.y,this.z-t.z)}angle(t){return n.atan2(this.cross(t).length(),this.dot(t))}flip(){this.x*=-1,this.y*=-1,this.z*=-1}static pointing2Vec3(t){let s=n.sin(t.theta),e=s*n.cos(t.phi),i=s*n.sin(t.phi),h=n.cos(t.theta);return new a(e,i,h)}}class o{constructor(t){let s=t.length;if(s>=2){this.center=t[0].add(t[1]),this.center.normalize(),this.cosrad=t[0].dot(this.center);for(let e=2;e<s;++e)t[e].dot(this.center)<this.cosrad&&this.getCircle(t,e)}else console.log("too few points")}getCircle(t,s){this.center=t[0].add(t[s]),this.center.normalize(),this.cosrad=t[0].dot(this.center);for(let e=1;e<s;++e)t[e].dot(this.center)<this.cosrad&&this.getCircle2(t,e,s)}getCircle2(t,s,e){this.center=t[s].add(t[e]),this.center.normalize(),this.cosrad=t[s].dot(this.center);for(let i=0;i<s;++i)t[i].dot(this.center)<this.cosrad&&(this.center=t[s].sub(t[i]).cross(t[e].sub(t[i])),this.center.normalize(),this.cosrad=t[i].dot(this.center),this.cosrad<0&&(this.center.flip(),this.cosrad=-this.cosrad))}getCenter(){return new a(this.center.x,this.center.y,this.center.z)}getCosrad(){return this.cosrad}}class l{constructor(t,s,e){this.fx=t,this.fy=s,this.face=e,this.jrll=new Uint8Array([2,2,2,2,3,3,3,3,4,4,4,4]),this.jpll=new Uint8Array([1,3,5,7,0,2,4,6,1,3,5,7]),this.halfpi=Math.PI/2}toHploc(){let t,s=new n,e=this.jrll[this.face]-this.fx-this.fy;if(e<1){t=e;let i=t*t/3;s.z=1-i,s.z>.99&&(s.sth=Math.sqrt(i*(2-i)),s.have_sth=!0)}else if(e>3){t=4-e;let i=t*t/3;s.z=i-1,s.z<-.99&&(s.sth=Math.sqrt(i*(2-i)),s.have_sth=!0)}else t=1,s.z=2*(2-e)/3;let i=this.jpll[this.face]*t+this.fx-this.fy;return i<0&&(i+=8),i>=8&&(i-=8),s.phi=t<1e-15?0:.5*this.halfpi*i/t,s}toVec3(){return this.toHploc().toVec3()}}class c{constructor(t){t<0&&console.error("capacity must be positive"),this.r=new Int32Array(t<<1),this.sz=0}append(t){this.append1(t,t+1)}append1(t,s){if(t>=s)return;if(this.sz>0&&t<=this.r[this.sz-1])return t<this.r[this.sz-2]&&console.error("bad append operation"),void(s>this.r[this.sz-1]&&(this.r[this.sz-1]=s));let e=this.sz+2;if(this.r.length<e){let t=Math.max(2*this.r.length,e),s=new Int32Array(t);s.set(this.r),this.r=s}this.r[this.sz]=t,this.r[this.sz+1]=s,this.sz+=2}ensureCapacity(t){this.r.length<t&&this.resize(Math.max(2*this.r.length,t))}resize(t){if(t<this.sz&&console.error("requested array size too small"),t==this.r.length)return;new Int32Array(t);let s=this.r.slice(0,this.sz+1);this.r=s}}class p{constructor(t,s,e){this.ix=t,this.iy=s,this.face=e}}class f{constructor(t){this.order_max=29,this.inv_halfpi=2/Math.PI,this.twothird=2/3,this.ns_max=Math.pow(2,this.order_max),this.ctab=new Uint16Array([0,1,256,257,2,3,258,259,512,513,768,769,514,515,770,771,4,5,260,261,6,7,262,263,516,517,772,773,518,519,774,775,1024,1025,1280,1281,1026,1027,1282,1283,1536,1537,1792,1793,1538,1539,1794,1795,1028,1029,1284,1285,1030,1031,1286,1287,1540,1541,1796,1797,1542,1543,1798,1799,8,9,264,265,10,11,266,267,520,521,776,777,522,523,778,779,12,13,268,269,14,15,270,271,524,525,780,781,526,527,782,783,1032,1033,1288,1289,1034,1035,1290,1291,1544,1545,1800,1801,1546,1547,1802,1803,1036,1037,1292,1293,1038,1039,1294,1295,1548,1549,1804,1805,1550,1551,1806,1807,2048,2049,2304,2305,2050,2051,2306,2307,2560,2561,2816,2817,2562,2563,2818,2819,2052,2053,2308,2309,2054,2055,2310,2311,2564,2565,2820,2821,2566,2567,2822,2823,3072,3073,3328,3329,3074,3075,3330,3331,3584,3585,3840,3841,3586,3587,3842,3843,3076,3077,3332,3333,3078,3079,3334,3335,3588,3589,3844,3845,3590,3591,3846,3847,2056,2057,2312,2313,2058,2059,2314,2315,2568,2569,2824,2825,2570,2571,2826,2827,2060,2061,2316,2317,2062,2063,2318,2319,2572,2573,2828,2829,2574,2575,2830,2831,3080,3081,3336,3337,3082,3083,3338,3339,3592,3593,3848,3849,3594,3595,3850,3851,3084,3085,3340,3341,3086,3087,3342,3343,3596,3597,3852,3853,3598,3599,3854,3855]),this.utab=new Uint16Array([0,1,4,5,16,17,20,21,64,65,68,69,80,81,84,85,256,257,260,261,272,273,276,277,320,321,324,325,336,337,340,341,1024,1025,1028,1029,1040,1041,1044,1045,1088,1089,1092,1093,1104,1105,1108,1109,1280,1281,1284,1285,1296,1297,1300,1301,1344,1345,1348,1349,1360,1361,1364,1365,4096,4097,4100,4101,4112,4113,4116,4117,4160,4161,4164,4165,4176,4177,4180,4181,4352,4353,4356,4357,4368,4369,4372,4373,4416,4417,4420,4421,4432,4433,4436,4437,5120,5121,5124,5125,5136,5137,5140,5141,5184,5185,5188,5189,5200,5201,5204,5205,5376,5377,5380,5381,5392,5393,5396,5397,5440,5441,5444,5445,5456,5457,5460,5461,16384,16385,16388,16389,16400,16401,16404,16405,16448,16449,16452,16453,16464,16465,16468,16469,16640,16641,16644,16645,16656,16657,16660,16661,16704,16705,16708,16709,16720,16721,16724,16725,17408,17409,17412,17413,17424,17425,17428,17429,17472,17473,17476,17477,17488,17489,17492,17493,17664,17665,17668,17669,17680,17681,17684,17685,17728,17729,17732,17733,17744,17745,17748,17749,20480,20481,20484,20485,20496,20497,20500,20501,20544,20545,20548,20549,20560,20561,20564,20565,20736,20737,20740,20741,20752,20753,20756,20757,20800,20801,20804,20805,20816,20817,20820,20821,21504,21505,21508,21509,21520,21521,21524,21525,21568,21569,21572,21573,21584,21585,21588,21589,21760,21761,21764,21765,21776,21777,21780,21781,21824,21825,21828,21829,21840,21841,21844,21845]),this.jrll=new Int16Array([2,2,2,2,3,3,3,3,4,4,4,4]),this.jpll=new Int16Array([1,3,5,7,0,2,4,6,1,3,5,7]),this.xoffset=new Int16Array([-1,-1,0,1,1,1,0,-1]),this.yoffset=new Int16Array([0,1,1,1,0,-1,-1,-1]),this.facearray=[new Int16Array([8,9,10,11,-1,-1,-1,-1,10,11,8,9]),new Int16Array([5,6,7,4,8,9,10,11,9,10,11,8]),new Int16Array([-1,-1,-1,-1,5,6,7,4,-1,-1,-1,-1]),new Int16Array([4,5,6,7,11,8,9,10,11,8,9,10]),new Int16Array([0,1,2,3,4,5,6,7,8,9,10,11]),new Int16Array([1,2,3,0,0,1,2,3,5,6,7,4]),new Int16Array([-1,-1,-1,-1,7,4,5,6,-1,-1,-1,-1]),new Int16Array([3,0,1,2,3,0,1,2,4,5,6,7]),new Int16Array([2,3,0,1,-1,-1,-1,-1,0,1,2,3])],this.swaparray=[new Int16Array([0,0,3]),new Int16Array([0,0,6]),new Int16Array([0,0,0]),new Int16Array([0,0,5]),new Int16Array([0,0,0]),new Int16Array([5,0,0]),new Int16Array([0,0,0]),new Int16Array([6,0,0]),new Int16Array([3,0,0])],t<=this.ns_max&&t>0&&(this.nside=t,this.npface=this.nside*this.nside,this.npix=12*this.npface,this.order=this.nside2order(this.nside),this.nl2=2*this.nside,this.nl3=3*this.nside,this.nl4=4*this.nside,this.fact2=4/this.npix,this.fact1=(this.nside<<1)*this.fact2,this.ncap=2*this.nside*(this.nside-1)),this.bn=[],this.mpr=[],this.cmpr=[],this.smpr=[]}computeBn(){for(let t=0;t<=this.order_max;++t)this.bn[t]=new f(1<<t),this.mpr[t]=this.bn[t].maxPixrad(),this.cmpr[t]=n.cos(this.mpr[t]),this.smpr[t]=n.sin(this.mpr[t])}getNPix(){return this.npix}getBoundaries(t){let s=new Array,e=this.nest2xyf(t),i=.5/this.nside,h=(e.ix+.5)/this.nside,r=(e.iy+.5)/this.nside;return s[0]=new l(h+i,r+i,e.face).toVec3(),s[1]=new l(h-i,r+i,e.face).toVec3(),s[2]=new l(h-i,r-i,e.face).toVec3(),s[3]=new l(h+i,r-i,e.face).toVec3(),s}getBoundariesWithStep(t,s){let e=new Array,i=this.nest2xyf(t),h=.5/this.nside,r=(i.ix+.5)/this.nside,n=(i.iy+.5)/this.nside,a=1/(this.nside*s);for(let t=0;t<s;t++)e[t]=new l(r+h-t*a,n+h,i.face).toVec3(),e[t+s]=new l(r-h,n+h-t*a,i.face).toVec3(),e[t+2*s]=new l(r-h+t*a,n-h,i.face).toVec3(),e[t+3*s]=new l(r+h,n-h+t*a,i.face).toVec3();return e}getPointsForXyfNoStep(t,s,e){let i=new Array,h=new p(t,s,e),r=.5/this.nside,n=(h.ix+.5)/this.nside,a=(h.iy+.5)/this.nside;return i[0]=new l(n+r,a+r,h.face).toVec3(),i[1]=new l(n-r,a+r,h.face).toVec3(),i[2]=new l(n-r,a-r,h.face).toVec3(),i[3]=new l(n+r,a-r,h.face).toVec3(),i}getPointsForXyf(t,s,e,i){let h=e*Math.pow(2,this.order),r=new Array,n=new p(t,s,i),a=.5/h,o=(n.ix+.5)/h,c=(n.iy+.5)/h;return r[0]=new l(o+a,c+a,n.face).toVec3(),r[1]=new l(o-a,c+a,n.face).toVec3(),r[2]=new l(o-a,c-a,n.face).toVec3(),r[3]=new l(o+a,c-a,n.face).toVec3(),r}neighbours(t){let s=new Int32Array(8),e=this.nest2xyf(t),i=e.ix,h=e.iy,r=e.face;var n=this.nside-1;if(i>0&&i<n&&h>0&&h<n){let t=Math.floor(r<<2*this.order),e=this.spread_bits(i),n=this.spread_bits(h)<<1,a=this.spread_bits(i+1),o=this.spread_bits(h+1)<<1,l=this.spread_bits(i-1),c=this.spread_bits(h-1)<<1;s[0]=t+l+n,s[1]=t+l+o,s[2]=t+e+o,s[3]=t+a+o,s[4]=t+a+n,s[5]=t+a+c,s[6]=t+e+c,s[7]=t+l+c}else for(let t=0;t<8;++t){let e=i+this.xoffset[t],n=h+this.yoffset[t],a=4;e<0?(e+=this.nside,a-=1):e>=this.nside&&(e-=this.nside,a+=1),n<0?(n+=this.nside,a-=3):n>=this.nside&&(n-=this.nside,a+=3);let o=this.facearray[a][r];if(o>=0){let i=this.swaparray[a][r>>>2];if((1&i)>0&&(e=Math.floor(this.nside-e-1)),(2&i)>0&&(n=Math.floor(this.nside-n-1)),(4&i)>0){let t=e;e=n,n=t}s[t]=this.xyf2nest(e,n,o)}else s[t]=-1}return s}nside2order(t){return 0!=(t&t-1)?-1:Math.log2(t)}nest2xyf(t){let s=Math.floor(t&this.npface-1);return new p(this.compress_bits(s),this.compress_bits(s>>1),Math.floor(t>>2*this.order))}xyf2nest(t,s,e){return Math.floor(e<<2*this.order)+this.spread_bits(t)+(this.spread_bits(s)<<1)}loc2pix(t){let s,e=t.z,i=t.phi,h=Math.abs(e),r=this.fmodulo(i*this.inv_halfpi,4);if(h<=this.twothird){let t=this.nside*(.5+r),i=this.nside*(.75*e),h=Math.floor(t-i),n=Math.floor(t+i),a=Math.floor(h>>>this.order),o=Math.floor(n>>>this.order),l=Math.floor(a==o?4|a:a<o?a:o+8),c=Math.floor(n&this.nside-1),p=Math.floor(this.nside-(h&this.nside-1)-1);s=this.xyf2nest(c,p,l)}else{let i=Math.min(3,Math.floor(r)),n=r-i,a=h<.99||!t.have_sth?this.nside*Math.sqrt(3*(1-h)):this.nside*t.sth/Math.sqrt((1+h)/3),o=Math.floor(n*a),l=Math.floor((1-n)*a);o>=this.nside&&(o=this.nside-1),l>=this.nside&&(l=this.nside-1),s=e>=0?this.xyf2nest(Math.floor(this.nside-l-1),Math.floor(this.nside-o-1),i):this.xyf2nest(Math.floor(o),Math.floor(l),i+8)}return s}pix2vec(t){return this.pix2loc(t).toVec3()}pix2zphi(t){return this.pix2loc(t).toZphi()}pix2ang(t,s){return this.pix2loc(t).toPointing(s)}pix2loc(t){let s,i=new n(void 0),h=this.nest2xyf(t),r=(this.jrll[h.face]<<this.order)-h.ix-h.iy-1;if(r<this.nside){s=r;let t=s*s*this.fact2;i.z=1-t,i.z>.99&&(i.sth=Math.sqrt(t*(2-t)),i.have_sth=!0)}else if(r>this.nl3){s=this.nl4-r;let t=s*s*this.fact2;i.z=t-1,i.z<-.99&&(i.sth=Math.sqrt(t*(2-t)),i.have_sth=!0)}else s=this.nside,i.z=(this.nl2-r)*this.fact1;let a=this.jpll[h.face]*s+h.ix-h.iy;return a<0&&(a+=8*s),i.phi=s==this.nside?.75*e.halfpi*a*this.fact1:.5*e.halfpi*a/s,i}za2vec(t,s){const e=Math.sqrt(1-t*t),i=e*Math.cos(s),h=e*Math.sin(s);return new a(i,h,t)}ang2vec(t,s){const e=Math.cos(t);return this.za2vec(e,s)}vec2ang(t){const{z:s,a:e}=this.vec2za(t.getX(),t.getY(),t.getZ());return{theta:Math.acos(s),phi:e}}vec2za(t,s,e){const i=t*t+s*s;if(0==i)return{z:e<0?-1:1,a:0};{const h=Math.PI/2,r=(Math.atan2(s,t)+h)%h;return{z:e/=Math.sqrt(e*e+i),a:r}}}ang2pix(t,s){return this.loc2pix(new n(t))}fmodulo(t,s){if(t>=0)return t<s?t:t%s;var e=t%s+s;return e===s?0:e}compress_bits(t){var s=Math.floor(21845&t)|Math.floor((1431633920&t)>>>15);return this.ctab[255&s]|this.ctab[s>>>8]<<4}spread_bits(t){return Math.floor(this.utab[255&t])|Math.floor(this.utab[t>>>8&255]<<16)|Math.floor(this.utab[t>>>16&255]<<32)|Math.floor(this.utab[t>>>24&255]<<48)}queryPolygonInclusive(t,s){let i=0!=s,r=t.length;if(!(r>=3))return void console.log("not enough vertices in polygon");let l=new Array;for(let s=0;s<r;++s)l[s]=a.pointing2Vec3(t[s]);let c=new Array,p=0,f=0,d=!1;for(;f<l.length;){let t=l[f],s=null,e=null;f==l.length-1?(e=l[1],s=l[0]):f==l.length-2?(e=l[0],s=l[f+1]):(s=l[f+1],e=l[f+2]),c[f]=t.cross(s).norm();let i=c[f].dot(e);if(0==f)p=i<0?-1:1,new h(t),d=!1;else{if(p*i<0){new h(s),l.splice(f+1,1),c.splice(f,1),d=!0,f-=1;continue}new h(t),d=!1}c[f].scale(p),f+=1}r=l.length;let u=new Array(i?r+1:r);if(u=u.fill(e.halfpi),i){let t=new o(l);c[r]=t.getCenter(),u[r]=n.acos(t.getCosrad())}return this.queryMultiDisc(c,u,s)}queryMultiDisc(t,s,e){this.computeBn();let h=0!=e,r=t.length;if(r!=s.length)return void console.error("inconsistent input arrays");let a=new c(8),o=0;h&&(Math.pow(2,this.order_max-this.order)>=e||console.error("invalid oversampling factor"),0!=(e&e-1)&&console.error("oversampling factor must be a power of 2"),o=this.ilog2(e));let l,p,f=this.order+o,d=new Array(f+1);for(l=0;l<=f;++l){d[l]=new Array(r);let t=this.bn[l].maxPixrad();for(p=0;p<r;++p)d[l][p]=new Float64Array(3),d[l][p][0]=s[p]+t>Math.PI?-1:n.cos(s[p]+t),d[l][p][1]=0==l?n.cos(s[p]):d[0][p][1],d[l][p][2]=s[p]-t<0?1:n.cos(s[p]-t)}let u=new i(12+3*f);for(let t=0;t<12;t++)u.push(11-t,0);for(;u.size()>0;){let s=u.ptop(),e=u.otop();u.pop();let i=this.bn[e].pix2vec(s),n=3;for(let s=0;s<r&&n>0;++s){let h=i.dot(t[s]);for(let t=0;t<n;++t)h<d[e][s][t]&&(n=t)}n>0&&this.check_pixel(e,f,n,a,s,u,h)}return a}ilog2(t){let s=Math.max(t,1);return 31-Math.clz32(s)}cosdist_zphi(t,s,e,i){return t*e+n.cos(s-i)*Math.sqrt((1-t*t)*(1-e*e))}check_pixel(t,s,e,i,h,r,n){if(0!=e)if(t<this.order)if(e>=3){let s=2*(this.order-t);i.append1(h<<s,h+1<<s)}else for(let s=0;s<4;++s)r.push(4*h+3-s,t+1);else if(t>this.order)if(e>=2)i.append(h>>>2*(t-this.order)),r.popToMark();else if(t<s)for(let s=0;s<4;++s)r.push(4*h+3-s,t+1);else i.append(h>>>2*(t-this.order)),r.popToMark();else if(e>=2)i.append(h);else if(n)if(this.order<s){r.mark();for(let s=0;s<4;++s)r.push(4*h+3-s,t+1)}else i.append(h)}maxPixrad(){let t=new r(2/3,Math.PI/this.nl4),s=this.convertZphi2xyz(t),e=new a(s[0],s[1],s[2]),i=1-1/this.nside;i*=i;let h=new r(1-i/3,0),n=this.convertZphi2xyz(h),o=new a(n[0],n[1],n[2]);return e.angle(o)}convertZphi2xyz(t){let s=Math.sqrt((1-t.z)*(1+t.z));return[s*n.cos(t.phi),s*n.sin(t.phi),t.z]}queryDiscInclusive(t,s,e){this.computeBn();let h=0!=e,r=new c;if(s>=Math.PI)return r.append1(0,this.npix),r;let o=0;h&&(0!=(e&e-1)&&console.error("oversampling factor must be a power of 2"),o=this.ilog2(e));let l=Math.min(this.order_max,this.order+o),p=a.pointing2Vec3(t),f=new Array(l+1),d=new Array(l+1),u=n.cos(s),y=n.sin(s);for(let t=0;t<=l;t++){let e=this.mpr[t],i=this.cmpr[t],h=this.smpr[t];f[t]=s+e>Math.PI?-1:u*i-y*h,d[t]=s-e<0?1:u*i+y*h}let w=new i(12+3*l);for(let t=0;t<12;t++)w.push(11-t,0);for(;w.size()>0;){let s=w.ptop(),e=w.otop();w.pop();let i=this.bn[e].pix2zphi(s),n=this.cosdist_zphi(p.z,t.phi,i.z,i.phi);if(n>f[e]){let t=n<u?1:n<=d[e]?2:3;this.check_pixel(e,l,t,r,s,w,h)}}return r}}return s})()));
//# sourceMappingURL=healpixjs.min.js.map